/**
 * プロジェクトの設定を管理するコンフィグオブジェクト
 *
 * @property {Object} paths - アセットの入出力パス設定
 * @property {Object} dev - 開発環境の設定
 * @property {Object} build - 本番環境の設定
 */

// ローカル設定を読み込み（個人環境依存の設定）
let localConfig = {};
try {
  const module = await import('./dai-runner.config.local.js');
  localConfig = module.default || {};
} catch (_e) {
  // ローカル設定がない場合はデフォルト値を使用
}

export const config = {
  // パス設定（ソースとビルド後のディレクトリを定義）
  paths: {
    images: {
      src: 'source/images',
      dist: 'public/assets/images',
    },
    js: {
      src: 'source/js',
      dist: 'public/assets/js',
    },
    css: {
      src: 'source/scss',
      dist: 'public/assets/css',
    },
  },

  // クリーンアップ設定
  cleanup: {
    // クリーンアップから除外するファイルやディレクトリを指定
    // テーマルートからの相対パスで指定（distディレクトリを含む完全なパス）
    excludeFiles: [
      // 'public/assets/images/keep-image.png',
      // 'public/assets/js/keep-js.js',
      // 'public/assets/css/keep-css.css',
    ],
  },

  // 画像最適化設定（開発・本番共通）
  images: {
    convertToWebp: true, // true: WebP形式に変換, false: 元の形式のまま
    imageQuality: 80, // 画質（1-100）
    maxWidth: 3840, // 最大幅（px）
    // 最適化から除外したいファイルがある場合は以下のコメントのように設定
    // （例：動くpng画像など）
    excludeFromOptimization: [
      // 'sample.png',
      // 'sample.jpg',
    ],
  },

  // 開発環境設定
  dev: {
    // mode と proxy は dai-runner.config.local.js で設定されます
    // 初回実行時に自動的に作成されます
    mode: localConfig.mode || 'server',
    server: { baseDir: 'public' },
    proxy: localConfig.proxy || {
      target: 'http://127.0.0.1',
      proxyReq: [],
    },
    options: {
      js: {
        minify: false, // true: コードを圧縮, false: 整形したまま
        sourceMap: true, // true: ソースマップを生成, false: 生成しない
        dropConsole: false, // true: console.log等を削除, false: console.logを残す
      },
      css: {
        minify: false, // true: CSSを圧縮, false: 整形したまま
        sourceMap: true, // true: ソースマップを生成, false: 生成しない
      },
      images: {
        useCache: true, // true: キャッシュを使用（高速化）, false: 毎回処理
      },
      logLevel: 'info', // ログレベル: 'info' | 'warn' | 'error'
    },
  },

  // 本番環境設定
  build: {
    options: {
      js: {
        minify: false, // true: コードを圧縮, false: 整形したまま
        sourceMap: false, // true: ソースマップを生成, false: 生成しない
        dropConsole: true, // true: console.log等を削除, false: console.logを残す
      },
      css: {
        minify: false, // true: CSSを圧縮, false: 整形したまま
        sourceMap: false, // true: ソースマップを生成, false: 生成しない
      },
      images: {
        useCache: false, // true: キャッシュを使用（高速化）, false: 毎回処理
      },
      logLevel: 'info', // ログレベル: 'info' | 'warn' | 'error'
    },
  },

  /**
   * 指定された環境の設定を取得
   * @param {string} env - 環境名（dev or build）
   * @returns {Object} 環境設定
   */
  get(env = process.env.NODE_ENV || 'dev') {
    const conf = this[env] || this.dev;
    return {
      ...conf,
      paths: this.paths,
      cleanup: this.cleanup,
      options: {
        ...conf.options,
        images: {
          ...this.images,
          ...conf.options.images, // 環境固有の設定で上書き
        },
      },
    };
  },
};
